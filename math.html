<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=1024">
  <title>math</title>
  <link rel="stylesheet" type="text/css" href="css/index.css">
  <script src="js/generic.js"></script>
  <script src="js/globals.js"></script>
  <script src="js/main.js"></script>
</head>
<body>
	<br>
	<table id="tb3">
		<col width="5%"><col width="10%"><col width="85%">
		<thead><tr><th colspan="3">math</th></tr></thead>
		<!--<tr><td colspan="3"><hr></td></tr>
		<tr><td colspan="3">HASHES & CODES</td></tr>-->
		<tr><td colspan="2"></td>
			<td>
				<button onClick="outputMath(`firefox`)">firefox</button>
				<button onClick="outputMath(`chrome`)">chrome</button>
				<button onClick="outputMath(`mac`)">mac</button>
			</td></tr>
		<tr><td colspan="3" class="center"></td></tr>
		<tr><td colspan="2">all</td><td class="c mono" id="hash0"></td></tr>
		<tr><td colspan="2">function</td><td class="c mono" id="hash1"></td></tr>
		<tr><td colspan="2">polyfill</td><td class="c mono" id="hash2"></td></tr>

		<tr><td colspan="3"><hr></td></tr>
		<tr><td colspan="3"><button class="btn0 btn" onClick="copyclip(`report`)">[ copy to clipboard ]</button> SHORT REPORT</td></tr>
		<tr><td colspan="2"></td><td class="c mono" id="report"></td></tr>
		<tr><td colspan="3"></td></tr>

		<tr><td colspan="3"><hr></td></tr>
		<tr><td colspan="3">DIFFS ANALYSIS</td></tr>
		<tr><td colspan="2"></td><td class="s3">vs control <span class="s12" id="controlname"></span></td></tr>
		<tr><td colspan="2"></td><td class="mono">denoted in <span class="s1">pale red</span></td></tr>
		<tr><td colspan="2">function</td><td class="c mono spaces" id="diff1"></td></tr>
		<tr><td colspan="2">polyfill</td><td class="c mono spaces" id="diff2"></td></tr>
		<tr><td colspan="2">test no's</td><td class="c mono" id="newnum"></td></tr>
		<tr><td colspan="3"></td></tr>

		<tr><td colspan="2"></td><td class="s3">polyfill vs function</td></tr>
		<tr><td colspan="2"></td><td class="mono">denoted with <span class = "s1">[match]</span></td></tr>
		<tr><td colspan="2">diffs</td><td class="c mono spaces" id="diff0"></td></tr>
		<tr><td colspan="3"></td></tr>

		<tr><td colspan="3"><hr></td></tr>
		<tr><td colspan="3"><button class="btn0 btn" onClick="copyclip(`mathdata`)">[ copy to clipboard ]</button> DATA</td></tr>
		<tr><td></td><td colspan="2" class="c mono spaces" id="mathdata"></td></tr>
	</table>
	<br>

<script>
'use strict';

// TZP ARRAY
var fns = [] // what tests to run
var n = 0.123
var bigN = 5.860847362277284e+38

// control sets
var controlname = ""
var tzpFF = [
	'-0.37419577499634155','-0.7854805190645291','0.7914463018528902','-0.767224894221913','-0.7415825695514536','0.5403023058681397','0.7086865671674246','-0.7482651726250321','0.9924450321351935','-1','-0.10868049424995659','-0.8913089376870335','-0.7108118501064332','-0.5369116957490239','-0.40677759702517235','-0.7017203400855445','0.43628480636189976','-0.6982689820462376','-0.6982689820462376','-0.6534063185820198','0.45375574259827833','0.6459044007438142','0.994076732536068','1.2246467991473532e-16','-0.7181630308570678','-0.765996413898051','0.9989410140273757','0.10135692924965614','-0.37463575478582023','-0.9892668187780497','0.5086861259107568','-1.2246467991473532e-16','0.686676154645243','1.618281713571588','-3.353712870537601','-1.922295546179998','-1.922295546179998','2.5824856130712437'
]
var tzpCHROME = [
	'-0.37419577499634155','-0.7854805190645291','0.7914463018528903','-0.767224894221913','-0.7415825695514535','0.5403023058681398','0.7086865671674247','-0.7482651726250322','0.9924450321351935','-1','-0.10868049424995659','-0.8913089376870335','-0.7108118501064331','-0.536911695749024','-0.4067775970251724','-0.7017203400855446','0.4362848063618998','-0.6982689820462377','-0.6982689820462377','-0.6534063185820198','0.4537557425982784','0.6459044007438142','0.994076732536068','1.2246467991473532e-16','-0.7181630308570677','-0.7659964138980511','0.9989410140273756','0.10135692924965616','-0.3746357547858202','-0.9892668187780498','0.5086861259107568','-1.2246467991473532e-16','0.6866761546452431','1.6182817135715877','-3.3537128705376014','-1.9222955461799982','-1.9222955461799982','2.5824856130712432'
]
var tzpMAC = [
	'-0.3741957749963415','-0.7854805190645292','0.7914463018528903','-0.7672248942219131','-0.7415825695514535','0.5403023058681398','0.7086865671674247','-0.7482651726250322','0.9924450321351935','-1','-0.10868049424995659','-0.8913089376870335','-0.7108118501064331','-0.536911695749024','-0.40677759702517235','-0.7017203400855446','0.4362848063618998','-0.6982689820462377','-0.6982689820462377','-0.6534063185820198','0.4537557425982784','0.6459044007438142','0.994076732536068','1.2246467991473532e-16','-0.7181630308570677','-0.765996413898051','0.9989410140273756','0.10135692924965616','-0.37463575478582023','-0.9892668187780498','0.5086861259107567','-1.2246467991473532e-16','0.686676154645243','1.6182817135715875','-3.353712870537602','-1.922295546179998','-1.922295546179998','2.5824856130712437'
]
var newFF = [
	'1.4474840516030247','0.7853981633974483','709.889355822726','Infinity','1.811526272460853','1.8115262724608532','0.881373587019543','0.8813735870195432','0.12331227519187199','691.4686750787736','691.4686750787736','1.8622957433108482','1.885022066017804','1.1071487177940904','1.2626272556789115','0.5493061443340548','0.5493061443340548','5e-311','1.0038848218538872','4.641588833612779','1.4645918875615231','0.9924450321351935','-1','-0.10868049424995659','-0.8913089376870335','-0.7108118501064332','-0.5369116957490239','-0.40677759702517235','-0.7017203400855445','0.43628480636189976','-0.6982689820462376','-0.6982689820462376','-0.6534063185820198','0.45375574259827833','0.6459044007438142','1.5430806348152437','1.5430806348152437','11.591953275521519','11.591953275521519','9.199870313877774e+307','1.046919966902314e+308','1.718281828459045','22.140692632779267','1.1308844209474893','23.140692632779267','9.539392014169456','9.539392014169458','8.288489826731114e+38','8.288489826731116e+38','100.14767208675258','100.14767208675259','101.7610227859332','101.76102278593319','100.00960859865252','100.0096085986525','100.01040630344927','100.01040630344929','100.00999950005','100.00999950004999','100.00249996875078','100.0024999687508','100.00377216279418','100.00377216279416','-2.0955709236097197','1.1447298858494002','0.11600367575630613','0.11600367575630613','1.4210804127942926','1.4210804127942926','-0.9100948885606021','-0.9100948885606022','0.49714987269413385','0.49714987269413385','0.4342944819032518','0.4342944819032518','1.965773398945507','1.965773398945507','-0.1591745389548616','-0.1591745389548616','0.8822181462033635','0.8822181462033635','0.15917453895486158','0.15917453895486158','1.7926429945344482','1.792642994534448','-0.36221568869946325','-0.3622156886994632','0.48288235131479357','0.4828823513147936','-0.15051499783199057','-0.15051499783199057','0.15051499783199063','0.1505149978319906','0.15051499783199063','0.1505149978319906','0.994076732536068','1.2246467991473532e-16','-0.7181630308570678','-0.765996413898051','0.9989410140273757','0.10135692924965614','-0.37463575478582023','-0.9892668187780497','1.1752011936438014','1.1752011936438014','11.548739357257748','11.548739357257748','7.544137102816975','7.544137102816975','0.75','0.75','1.9978980091062795','1.9978980091062797','9.199870313877774e+307','Infinity','0.44807597941469024','0.4480759794146903','0.7675231451261164','0.7675231451261164','1.935066822174357','1.9350668221743568','1.046919966902314e+308','Infinity','0.3507135583350036','1.7724538509055159','0.5086861259107568','-1.2246467991473532e-16','0.686676154645243','1.618281713571588','-3.353712870537601','-1.922295546179998','-1.922295546179998','2.5824856130712437','0.12238344189440875','0.12238344189440872','0.99627207622075','0.9962720762207501','1.0220893335845176e+91','1.9275814160560185e-50','3.720075976020851e-44','8269017203802410','6.003867926738811e-37','1.2093335584550061e-16','1.665592934758592e+36','1125899906842611.5','8.881784197001154e-16'
]
var newCHROME = [
	'1.4474840516030247','0.7853981633974483','709.889355822726','Infinity','1.811526272460853','1.8115262724608532','0.881373587019543','0.8813735870195432','0.12331227519187199','691.4686750787736','691.4686750787736','1.8622957433108482','1.885022066017804','1.1071487177940904','1.2626272556789115','0.5493061443340548','0.5493061443340548','5e-311','1.0038848218538872','4.641588833612779','1.4645918875615231','0.9924450321351935','-1','-0.10868049424995659','-0.8913089376870335','-0.7108118501064331','-0.536911695749024','-0.4067775970251724','-0.7017203400855446','0.4362848063618998','-0.6982689820462377','-0.6982689820462377','-0.6534063185820198','0.4537557425982784','0.6459044007438142','1.5430806348152437','1.5430806348152437','11.591953275521519','11.591953275521519','9.199870313877772e+307','1.0469199669023138e+308','1.718281828459045','22.140692632779267','1.1308844209474893','23.140692632779267','9.539392014169456','9.539392014169458','8.288489826731116e+38','8.288489826731116e+38','100.14767208675259','100.14767208675259','101.76102278593319','101.76102278593319','100.0096085986525','100.0096085986525','100.01040630344929','100.01040630344929','100.00999950004999','100.00999950004999','100.0024999687508','100.0024999687508','100.00377216279416','100.00377216279416','-2.0955709236097197','1.1447298858494002','0.11600367575630613','0.11600367575630613','1.4210804127942926','1.4210804127942926','-0.9100948885606021','-0.9100948885606022','0.4971498726941338','0.49714987269413385','0.4342944819032518','0.4342944819032518','1.9657733989455068','1.965773398945507','-0.1591745389548616','-0.1591745389548616','0.8822181462033634','0.8822181462033635','0.15917453895486158','0.15917453895486158','1.792642994534448','1.792642994534448','-0.36221568869946325','-0.3622156886994632','0.4828823513147936','0.4828823513147936','-0.15051499783199057','-0.15051499783199057','0.1505149978319906','0.1505149978319906','0.1505149978319906','0.1505149978319906','0.994076732536068','1.2246467991473532e-16','-0.7181630308570677','-0.7659964138980511','0.9989410140273756','0.10135692924965616','-0.3746357547858202','-0.9892668187780498','1.1752011936438014','1.1752011936438014','11.548739357257748','11.548739357257748','7.544137102816975','7.544137102816975','0.75','0.75','1.9978980091062795','1.9978980091062797','9.199870313877772e+307','Infinity','0.44807597941469024','0.4480759794146903','0.7675231451261164','0.7675231451261164','1.935066822174357','1.9350668221743568','1.0469199669023138e+308','Infinity','0.3507135583350036','1.7724538509055159','0.5086861259107568','-1.2246467991473532e-16','0.6866761546452431','1.6182817135715877','-3.3537128705376014','-1.9222955461799982','-1.9222955461799982','2.5824856130712432','0.12238344189440875','0.12238344189440872','0.99627207622075','0.9962720762207501','1.022089333584519e+91','1.9275814160560204e-50','3.7200759760208555e-44','8269017203802394','6.003867926738829e-37','1.20933355845501e-16','1.6655929347585958e+36','1125899906842616.2','8.881784197001191e-16'
]
var newMAC = [
	'1.4474840516030245','0.7853981633974483','709.889355822726','Infinity','1.811526272460853','1.8115262724608532','0.8813735870195432','0.8813735870195432','0.12331227519187199','691.4686750787736','691.4686750787736','1.8622957433108482','1.885022066017804','1.1071487177940906','1.2626272556789115','0.5493061443340549','0.5493061443340549','5e-311','1.0038848218538872','4.641588833612779','1.4645918875615234','0.9924450321351935','-1','-0.10868049424995659','-0.8913089376870335','-0.7108118501064331','-0.536911695749024','-0.40677759702517235','-0.7017203400855446','0.4362848063618998','-0.6982689820462377','-0.6982689820462377','-0.6534063185820198','0.4537557425982784','0.6459044007438142','1.5430806348152437','1.5430806348152437','11.591953275521519','11.591953275521519','9.199870313877772e+307','1.0469199669023138e+308','1.7182818284590453','22.140692632779267','1.1308844209474893','23.140692632779267','9.539392014169456','9.539392014169458','8.288489826731116e+38','8.288489826731116e+38','100.14767208675259','100.14767208675259','101.76102278593319','101.76102278593319','100.0096085986525','100.0096085986525','100.01040630344929','100.01040630344929','100.00999950004999','100.00999950004999','100.0024999687508','100.0024999687508','100.00377216279416','100.00377216279416','-2.0955709236097197','1.1447298858494002','0.11600367575630613','0.11600367575630613','1.4210804127942926','1.4210804127942926','-0.9100948885606021','-0.9100948885606022','0.49714987269413385','0.49714987269413385','0.4342944819032518','0.4342944819032518','1.965773398945507','1.965773398945507','-0.1591745389548616','-0.1591745389548616','0.8822181462033635','0.8822181462033635','0.15917453895486158','0.15917453895486158','1.7926429945344482','1.792642994534448','-0.36221568869946325','-0.3622156886994632','0.48288235131479357','0.4828823513147936','-0.15051499783199057','-0.15051499783199057','0.15051499783199063','0.1505149978319906','0.15051499783199063','0.1505149978319906','0.994076732536068','1.2246467991473532e-16','-0.7181630308570677','-0.765996413898051','0.9989410140273756','0.10135692924965616','-0.37463575478582023','-0.9892668187780498','1.1752011936438014','1.1752011936438014','11.548739357257746','11.548739357257748','7.544137102816975','7.544137102816975','0.75','0.75','1.9978980091062795','1.9978980091062797','9.199870313877772e+307','Infinity','0.44807597941469024','0.4480759794146903','0.7675231451261164','0.7675231451261164','1.9350668221743568','1.9350668221743568','1.0469199669023138e+308','Infinity','0.3507135583350036','1.7724538509055159','0.5086861259107567','-1.2246467991473532e-16','0.686676154645243','1.6182817135715875','-3.353712870537602','-1.922295546179998','-1.922295546179998','2.5824856130712437','0.12238344189440876','0.12238344189440872','0.99627207622075','0.9962720762207501','1.022089333584519e+91','1.9275814160560206e-50','3.7200759760208555e-44','8269017203802394','6.003867926738829e-37','1.20933355845501e-16','1.6655929347585955e+36','1125899906842616.2','8.881784197001191e-16'
]

var tzpfns = []
var newfns = []

function build_arrays(engine) {
	let c = []
	// TZP
	if (engine == "firefox") {
		c = tzpFF
	} else if (engine == "chrome") {
		c = tzpCHROME
	} else if (engine == "mac") {
		c = tzpMAC
	}
	tzpfns = [
		// original TZP 8
		[  1, 'cos', [1e251], "1e251", c[0]],
		[  2, 'cos', [1e140], "1e140", c[1]],
		[  3, 'cos', [1e12], "1e12", c[2]],
		[  4, 'cos', [1e130], "1e130", c[3]],
		[  5, 'cos', [1e272], "1e272", c[4]],
		[  6, 'cos', [1e0], "1e0", c[5]],
		[  7, 'cos', [1e284], "1e284", c[6]],
		[  8, 'cos', [1e75], "1e75", c[7]],
		// additional new to compare as a subset to TZP
		[180, 'cos', [n], n, c[8]],
		[181, 'cos', [Math.PI], "Math.PI", c[9]],
		[182, 'cos', [bigN], "bigN", c[10]],
		[183, 'cos', [-1e308], '-1e308', c[11]],
		[184, 'cos', [13*Math.E], '13*Math.E', c[12]],
		[185, 'cos', [57*Math.E], '57*Math.E', c[13]],
		[186, 'cos', [21*Math.LN2], '21*Math.LN2', c[14]],
		[187, 'cos', [51*Math.LN2], '51*Math.LN2', c[15]],
		[188, 'cos', [21*Math.LOG2E], '21*Math.LOG2E', c[16]],
		[189, 'cos', [25*Math.SQRT2], '25*Math.SQRT2', c[17]],
		[190, 'cos', [50*Math.SQRT1_2], '50*Math.SQRT1_2', c[18]],
		[191, 'cos', [21*Math.SQRT1_2], '21*Math.SQRT1_2', c[19]],
		[192, 'cos', [17*Math.LOG10E], '17*Math.LOG10E', c[20]],
		[193, 'cos', [2*Math.LOG10E], '2*Math.LOG10E', c[21]],
		[340, 'sin', [bigN], "bigN", c[22]],
		[341, 'sin', [Math.PI], "Math.PI", c[23]],
		[342, 'sin', [39*Math.E], "39*Math.E", c[24]],
		[343, 'sin', [35*Math.LN2], "35*Math.LN2", c[25]],
		[344, 'sin', [110*Math.LOG2E], "110*Math.LOG2E", c[26]],
		[345, 'sin', [7*Math.LOG10E], "7*Math.LOG10E", c[27]],
		[346, 'sin', [35*Math.SQRT1_2], "35*Math.SQRT1_2", c[28]],
		[347, 'sin', [21*Math.SQRT2], "21*Math.SQRT2", c[29]],
		[400, 'tan', [-1e308], "-1e308", c[30]],
		[401, 'tan', [Math.PI], "Math.PI", c[31]],
		[402, 'tan', [6*Math.E], '6*Math.E', c[32]],
		[403, 'tan', [6*Math.LN2], '6*Math.LN2', c[33]],
		[404, 'tan', [10*Math.LOG2E], '10*Math.LOG2E', c[34]],
		[405, 'tan', [17*Math.SQRT2], '17*Math.SQRT2', c[35]],
		[406, 'tan', [34*Math.SQRT1_2], '34*Math.SQRT1_2', c[36]],
		[407, 'tan', [10*Math.LOG10E], '10*Math.LOG10E', c[37]],
	]
	// NEW
	if (engine == "firefox") {
		c = newFF
	} else if (engine == "chrome") {
		c = newCHROME
	} else if (engine == "mac") {
		c = newMAC
	}
	newfns = [
		// [item, function, value, description, control, poly1 control, poly2 control]
		[ 20,  'acos', [n], n, c[0]],
		[ 21,  'acos', [Math.SQRT1_2], "Math.SQRT1_2", c[1]],
		[ 40, 'acosh', [1e308], "1e300", c[2], c[3]],
		[ 41, 'acosh', [Math.PI], "Math.PI", c[4], c[5]],
		[ 42, 'acosh', [Math.SQRT2], "Math.SQRT2", c[6], c[7]],
		[ 60,  'asin', [n], n, c[8]],
		[ 80, 'asinh', [1e300], "1e300", c[9], c[10]],
		[ 81, 'asinh', [Math.PI], "Math.PI", c[11], c[12]],
		[100,  'atan', [2], "2", c[13]],
		[101,  'atan', [Math.PI], "Math.PI", c[14]],
		[120, 'atanh', [0.5], "0.5", c[15], c[16]],
		[140, 'atan2', [1e-310, 2], "1e-310, 2", c[17]],
		[141, 'atan2', [Math.PI, 2], "Math.PI, 2", c[18]],
		[160,  'cbrt', [100], "100", c[19]],
		[161,  'cbrt', [Math.PI], "Math.PI", c[20]],
		[180,   'cos', [n], n, c[21]],
		[181,   'cos', [Math.PI], "Math.PI", c[22]],
		[182,   'cos', [bigN], "bigN", c[23]], // creep says unique in Tor
		[183,   'cos', [-1e308], '-1e308', c[24]],
		[184,   'cos', [13*Math.E], '13*Math.E', c[25]],
		[185,   'cos', [57*Math.E], '57*Math.E', c[26]],
		[186,   'cos', [21*Math.LN2], '21*Math.LN2', c[27]],
		[187,   'cos', [51*Math.LN2], '51*Math.LN2', c[28]],
		[188,   'cos', [21*Math.LOG2E], '21*Math.LOG2E', c[29]],
		[189,   'cos', [25*Math.SQRT2], '25*Math.SQRT2', c[30]],
		[190,   'cos', [50*Math.SQRT1_2], '50*Math.SQRT1_2', c[31]],
		[191,   'cos', [21*Math.SQRT1_2], '21*Math.SQRT1_2', c[32]],
		[192,   'cos', [17*Math.LOG10E], '17*Math.LOG10E', c[33]],
		[193,   'cos', [2*Math.LOG10E], '2*Math.LOG10E', c[34]],
		[200,  'cosh', [1], "1", c[35], c[36]],
		[201,  'cosh', [Math.PI], "Math.PI", c[37], c[38]],
		[202,  'cosh', [492*Math.LOG2E], '492*Math.LOG2E', c[39]],
		[203,  'cosh', [502*Math.SQRT2], '502*Math.SQRT2', c[40]],
		[220, 'expm1', [1], "1", c[41]],
		[221, 'expm1', [Math.PI], "Math.PI", c[42]],
		[240,   'exp', [n], n, c[43]],
		[241,   'exp', [Math.PI], "Math.PI", c[44]],
		[260, 'hypot', [1,2,3,4,5,6], "1,2,3,4,5,6", c[45], c[46]],
		[261, 'hypot', [bigN, bigN], "bigN, bigN", c[47], c[48]],
		[262, 'hypot', [2*Math.E,-100], '2*Math.E,-100', c[49], c[50]],
		[263, 'hypot', [6*Math.PI,-100], '6*Math.PI,-100', c[51], c[52]],
		[264, 'hypot', [2*Math.LN2,-100], '2*Math.LN2,-100', c[53], c[54]],
		[265, 'hypot', [Math.LOG2E,-100], 'Math.LOG2E,-100', c[55], c[56]],
		[266, 'hypot', [Math.SQRT2,-100], 'Math.SQRT2,-100', c[57], c[58]],
		[267, 'hypot', [Math.SQRT1_2,-100], 'Math.SQRT1_2,-100',c[59], c[60]],
		[268, 'hypot', [2*Math.LOG10E,-100], '2*Math.LOG10E,-100', c[61], c[62]],
		[280,   'log', [n], n, c[63]],
		[281,   'log', [Math.PI], "Math.PI", c[64]],
		[300, 'log1p', [n], n, c[65], c[66]],
		[301, 'log1p', [Math.PI], "Math.PI", c[67], c[68]],
		[320, 'log10', [n], n, c[69], c[70]],
		[321, 'log10', [Math.PI], "Math.PI", c[71], c[72]],
		[322, 'log10', [Math.E], "Math.E", c[73], c[74]],
		[323, 'log10', [34*Math.E], '34*Math.E', c[75], c[76]],
		[324, 'log10', [Math.LN2], "Math.LN2", c[77], c[78]],
		[325, 'log10', [11*Math.LN2], '11*Math.LN2', c[79], c[80]],
		[326, 'log10', [Math.LOG2E], "Math.LOG2E", c[81], c[82]],
		[327, 'log10', [43*Math.LOG2E], '43*Math.LOG2E', c[83], c[84]],
		[328, 'log10', [Math.LOG10E], "Math.LOG10E", c[85], c[86]],
		[329, 'log10', [7*Math.LOG10E], '7*Math.LOG10E', c[87], c[88]],
		[330, 'log10', [Math.SQRT1_2], "Math.SQRT1_2", c[89], c[90]],
		[331, 'log10', [2*Math.SQRT1_2], '2*Math.SQRT1_2', c[91], c[92]],
		[332, 'log10', [Math.SQRT2], "Math.SQRT2", c[93], c[94]],
		[340,   'sin', [bigN], "bigN", c[95]], // creep says unique in Tor
		[341,   'sin', [Math.PI], "Math.PI", c[96]], // creep says unique in Tor
		[342,   'sin', [39*Math.E], "39*Math.E", c[97]],
		[343,   'sin', [35*Math.LN2], "35*Math.LN2", c[98]],
		[344,   'sin', [110*Math.LOG2E], "110*Math.LOG2E", c[99]],
		[345,   'sin', [7*Math.LOG10E], "7*Math.LOG10E", c[100]],
		[346,   'sin', [35*Math.SQRT1_2], "35*Math.SQRT1_2", c[101]],
		[347,   'sin', [21*Math.SQRT2], "21*Math.SQRT2", c[102]],
		[360,  'sinh', [1], "1", c[103], c[104]],
		[361,  'sinh', [Math.PI], "Math.PI", c[105], c[106]],
		[362,  'sinh', [Math.E], "Math.E", c[107], c[108]],
		[363,  'sinh', [Math.LN2], "Math.LN2", c[109], c[110]],
		[364,  'sinh', [Math.LOG2E], "Math.LOG2E", c[111], c[112]],
		[365,  'sinh', [492*Math.LOG2E], '492*Math.LOG2E', c[113], c[114]],
		[366,  'sinh', [Math.LOG10E], "Math.LOG10E", c[115], c[116]],
		[367,  'sinh', [Math.SQRT1_2], "Math.SQRT1_2", c[117], c[118]],
		[368,  'sinh', [Math.SQRT2], "Math.SQRT2", c[119], c[120]],
		[369,  'sinh', [502*Math.SQRT2], '502*Math.SQRT2', c[121], c[122]],
		[380,  'sqrt', [n], n, c[123]],
		[381,  'sqrt', [Math.PI], "Math.PI", c[124]],
		[400,   'tan', [-1e308], "-1e308", c[125]],
		[401,   'tan', [Math.PI], "Math.PI", c[126]],
		[402,   'tan', [6*Math.E], '6*Math.E', c[127]],
		[403,   'tan', [6*Math.LN2], '6*Math.LN2', c[128]],
		[404,   'tan', [10*Math.LOG2E], '10*Math.LOG2E', c[129]],
		[405,   'tan', [17*Math.SQRT2], '17*Math.SQRT2', c[130]],
		[406,   'tan', [34*Math.SQRT1_2], '34*Math.SQRT1_2', c[131]],
		[407,   'tan', [10*Math.LOG10E], '10*Math.LOG10E', c[132]],
		[420,  'tanh', [n], n, c[133], c[134]],
		[421,  'tanh', [Math.PI], "Math.PI", c[135], c[136]],
		[440,   'pow', [n,-100], n+",-100", c[137]],
		[441,   'pow', [Math.PI,-100], "Math.PI,-100", c[138]],
		[442,   'pow', [Math.E,-100], "Math.E,-100", c[139]],
		[443,   'pow', [Math.LN2,-100], "Math.LN2,-100", c[140]],
		[444,   'pow', [Math.LN10,-100], "Math.LN10,-100", c[141]],
		[445,   'pow', [Math.LOG2E,-100], "Math.LOG2E,-100", c[142]],
		[446,   'pow', [Math.LOG10E,-100], "Math.LOG10E,-100", c[143]],
		[447,   'pow', [Math.SQRT1_2,-100], "Math.SQRT1_2,-100", c[144]],
		[448,   'pow', [Math.SQRT2,-100], "Math.SQRT2,-100", c[145]],
	]
}

	// POLYFILLS
	const acosh = x => Math.log(x + Math.sqrt(x * x - 1))
	const asinh = x => {
		const absX = Math.abs(x)
		if (absX < Math.pow(2, -28)) {
			return x
		}
		const w = (
			absX > Math.pow(2, 28) ? Math.log(absX) + Math.LN2 :
			absX > 2 ? Math.log(2 * absX + 1 / Math.sqrt(x * x + 1)) :
			Math.log1p(absX + (x * x) / (1 + Math.sqrt(1 + (x * x))))
    )
		return x > 0 ? w : -w
	}
	const atanh = x => Math.log((1 + x) / (1 - x)) / 2
	const cosh = x => (Math.exp(x) + Math.exp(-x)) / 2
	function hypot(array) {
		let i, s = 0,
			max = 0,
			isInfinity = false,
			len = array.length
		for (i = 0; i < len; ++i) {
			const arg = Math.abs(+array[i])
			if (arg === Infinity) {
				isInfinity = true
			}
			if (arg > max) {
				s *= (max / arg) * (max / arg)
				max = arg
			}
			s += arg === 0 && max === 0 ? 0 : (arg / max) * (arg / max)
		}
		return isInfinity ? Infinity : (max === Infinity ? Infinity : max * Math.sqrt(s))
	}
	const log1p = x => {
		const nearX = (x + 1) - 1
		return (
			x < -1 || x !== x ? NaN :
			x === 0 || x === Infinity ? x :
			nearX === 0 ? x :
			x * (Math.log(x + 1) / nearX)
		)
	}
	const log2 = x => Math.log(x) * Math.LOG2E
	const log10 = x => Math.log(x) * Math.LOG10E
	const sinh = x => (Math.exp(x) - Math.exp(-x)) / 2
	const tanh = x => {
		const a = Math.exp(+x)
		const b = Math.exp(-x)
		return a == Infinity ? 1 : b == Infinity ? -1 : (a - b) / (a + b)
	}


var tzpdisplay = [],
	newdisplay = []
	report = []

function get_results(type) {
	// vars
	let display = [],
		prevFn = "start",
		demarc = false,
		strDemarc = "----------------------------------------------------",
		sColor = s3,
		vPad = 19, // value tested
		fPad = vPad + 7, // function + value
		rPad = 23, // result
		nPad = 5, // user number: 5 means k indents by 2, and k+"p1"/"p2" is covered in diffs
		bigNstr = "* bigN = " + bigN

	// set what to test: tzp or new
	if (type == "tzp") {
		fns = tzpfns
		sColor = s12
		tzpdisplay = [s3.trim() + "control: " + controlname + sc + "<br>"]
		tzpdisplay.push(bigNstr.padStart(52) + "<br>")
		tzpdisplay.push(sColor.trim() +"TZP" + "<br>" + strDemarc + sc)
		report = [s3.trim() + "control: " + controlname + sc + "<br>"]
		report.push(sColor.trim() +"TZP" + "<br>" + strDemarc + sc)
	} else {
		fns = newfns
		newdisplay = ["<br><br>" + sColor.trim() +"NEW TESTS" + "<br>" + strDemarc + sc]
		report.push("<br><br>" + sColor.trim() +"NEW TESTS" + "<br>" + strDemarc + sc)
	}

	// BUILD TEST RESULTS
	let	math1 = [],	// functions
		math2 = [], // polyfills
		numbers = [] // numbers which make a difference
		let polymatch = [],
		fnmatch = [], // do not match control
		diffs = [] // fn + poly don't match

	let generate = []
	for(let i=0; i < fns.length; i++) {
		let fn = fns[i]
		let k = fn[0] // user defined number
		let kpad = (k.toString()).padStart(nPad)
		let fnResult = (Math[fn[1]](...fn[2])).toString()
		let fnValue = fn[3].toString()
		let fnControl = fn[4].toString()
		let fnName = fn[1].toString()

		// fn result
		let isFnDiff = false
		if (fnResult !== fnControl) {
			isFnDiff = true
			fnmatch.push(k+":"+fnName+"("+fn[3]+"):"+fnControl +":"+fnResult)
			numbers.push(k)
		}
		math1.push(k+":"+fnResult)
		generate.push("'"+fnResult+"'")

		// poly tests
		let poly1Result = ""
		let poly1Control = ""
		if (type == "new") {
			if (fn[5] !== undefined && fn[5] !== "") {
				poly1Control = fn[5].toString()
				if (fnName == "acosh") {
					poly1Result = acosh(...fn[2])
				} else if (fnName == "asinh") {
					poly1Result = asinh(...fn[2])
				} else if (fnName == "atanh") {
					poly1Result = atanh(...fn[2])
				} else if (fnName == "cosh") {
					poly1Result = cosh(...fn[2])
				} else if (fnName == "hypot") {
					// i need to pass an array
					poly1Result = hypot([...fn[2]])
				} else if (fnName == "log1p") {
					poly1Result = log1p(...fn[2])
				} else if (fnName == "log2") {
					poly1Result = log2(...fn[2])
				} else if (fnName == "log10") {
					poly1Result = log10(...fn[2])
				} else if (fnName == "sinh") {
					poly1Result = sinh(...fn[2])
				} else if (fnName == "tanh") {
					poly1Result = tanh(...fn[2])
				}
				poly1Result = poly1Result.toString()
				//console.debug(k, fn[3], fnName, poly1Control, poly1Result)
			}
		}
		// poly1 results
		let isPolyDiff = false, isDiff = false
		if (poly1Result !== "") {
			if (poly1Result !== poly1Control) {
				isPolyDiff = true
				polymatch.push(k+"p1:"+fnName+"("+fn[3]+"):"+poly1Control +":"+poly1Result)
				numbers.push(k+"p1")
			}
			math2.push(k+"p1:"+poly1Result)
			generate.push("'"+poly1Result+"'")
			// does not match fn
			if (poly1Result !== fnResult) {
				isDiff = true
				diffs.push(k+"p1:"+fnName+"("+fn[3]+"):"+fnResult +":"+poly1Result)
			}
		}

		// color & pad
		if (isFnDiff) {
			fnResult = s1.trim() + fnResult.padStart(rPad) + sc
		} else {
			fnResult = fnResult.padStart(rPad)
		}
		if (isPolyDiff) {
			poly1Result = s1.trim() + poly1Result.padStart(rPad) + sc
		} else {
			poly1Result = poly1Result.padStart(rPad)
		}
		if (isDiff) {
			poly1Result += s1 + "[match]" +sc
		}
		if (poly1Result !== "") {
			fnResult += ", " + poly1Result
		}

		// demarcate each function
		if (prevFn !== fnName) {demarc = true} else {demarc = false}
		if (demarc == true) {
			if (type == "tzp" && k == "1") {
				display.push(sColor.trim() + strDemarc +"<br>"+ fnName.toUpperCase() + " [TZP ORIGINAL]" + sc)
			} else {
				display.push(sColor.trim() + strDemarc +"<br>"+ fnName.toUpperCase() + sc)
			}
		} else {
			if (type == "tzp" && k == "180") {
				display.push(sColor.trim() + strDemarc +"<br>"+ fnName.toUpperCase() + sc)
			}
		} 

		display.push(kpad+": "+ sColor + fnValue.padEnd(vPad) + sc + ": " +fnResult)

		// remember last function
		prevFn = fn[1]
	}
	// generate control lists
	//console.log("CONTROL LIST: " + type + "\n" + generate.join(","))

	// numbers
	numbers.sort((a,b) => a-b)
	numbers = numbers.filter(function(item, position) {return numbers.indexOf(item) === position})
	numbers.sort((a,b) => a-b)
	let numstr = "none"
	if (numbers.length > 0) {
		numstr = numbers.join(", ")
	}
	if (type == "new") {
		document.getElementById(type+"num").innerHTML = numstr
	}

	// diffs
	function output_diffs(array, type) {
		let output = []
		if (array.length > 0) {
			for(let i=0; i < array.length; i++) {
				let part0 = array[i].split(":")[0]
					part0 = (part0.toString()).padStart(nPad)
				let part1 = array[i].split(":")[1]
					part1 = (part1.toString()).padStart(fPad)
				let part2 = array[i].split(":")[2]
					part2 = (part2.toString()).padStart(rPad)
				let part3 = array[i].split(":")[3]
				output.push(part0 + ":" + s3 + part1 + sc + " s/be " + s3.trim() + part2 + sc + " got" + s1 + part3 + sc)
			}
			document.getElementById("diff" + type).innerHTML = output.join("<br>")
		} else {
			document.getElementById("diff" + type).innerHTML = "none"
		}
	}

	// hashes
	if (type == "tzp") {

		// OLD HASH
		let tzptemp = math1.slice(0,8)
		let tzparray1 = []
		for(let i=0; i < tzptemp.length; i++) {
			let part1 = tzptemp[i].split(":")[1]
			tzparray1.push(part1)
		}
		let tzphash1 = sha1(tzparray1.join("-")) // use "-" to match TZP
		let tzpcode1 = ""
		if (isFF) {
			// known FF hashes
			if (tzphash1 == "46f7c2bbe55a2cd28252d059604f8c3bac316c23") {tzpcode1="A"}
			else if (tzphash1 == "8464b989070dcff22c136e4d0fe21d466b708ece") {tzpcode1="B"}
			else if (tzphash1 == "97eee44856b0d2339f7add0d22feb01bcc0a430e") {tzpcode1="C"}
			else if (tzphash1 == "96895e004b623552b9543dcdc030640d1b108816") {tzpcode1="D"}
			else if (tzphash1 == "06a01549b5841e0ac26c875b456a33f95b5c5c11") {tzpcode1="E"}
			else if (tzphash1 == "ae434b101452888b756da5916d81f68adeb2b6ae") {tzpcode1="F"}
			else if (tzphash1 == "19df0b54c852f35f011187087bd3a0dce12b4071") {tzpcode1="G"}
			else if (tzphash1 == "8ee641f01271d500e5c1d40e831232214c0bbbdc") {tzpcode1="H"}
			if (tzpcode1 == "") {
				tzpcode1 = zNEW
			} else {
				tzpcode1 = s12 + "["+ tzpcode1 +"]" + sc
			}
		}

		// NEW HASH
		let tzparray2 = math1.slice(9,math1.length)
		let tzphash2 = sha1(tzparray2.join()) // the rest
		let tzpcode2 = ""
		if (isFF) {
			tzpcode2 = get_code(type, tzphash2)
		}
		tzpdisplay.push("tzp: " + tzphash1 + (isFF ? tzpcode1 : ""))
		tzpdisplay.push("new: " + tzphash2 + (isFF ? tzpcode2 : ""))
		tzpdisplay.push("nos: " + numstr)
		tzpdisplay = tzpdisplay.concat(display)

		report.push("tzp: " + tzphash1 + (isFF ? tzpcode1 : ""))
		report.push("new: " + tzphash2 + (isFF ? tzpcode2 : ""))
		report.push("nos: " + numstr)

	} else {
		// hashes
		let hash1 = sha1(math1.join())
		let hash2 = sha1(math2.join())
		let math3 = math1.concat(math2)
		let hash0 = sha1(math3.join())
		let maincode = get_code(type,hash0)

		//ToDo: assign short codes
		dom.hash1.innerHTML = hash1 //+ sColor +"["+ math1.length +"]"+sc
		if (math2.length > 0) {
			dom.hash2.innerHTML = hash2 //+ sColor +"["+ math2.length +"]"+sc
		} else {
			dom.hash2.innerHTML = "none run"
		}
		dom.hash0.innerHTML = hash0 + maincode

		newdisplay.push(" a11: " + hash0 + maincode)
		newdisplay.push("func: " + hash1)
		newdisplay.push("poly: " + hash2)
		newdisplay.push(" nos: " + numstr)
		newdisplay = newdisplay.concat(display)

		report.push(" a11: " + hash0 + maincode)
		report.push(" nos: " + numstr)

		// diffs
		output_diffs(diffs, 0)
		output_diffs(fnmatch, 1)
		output_diffs(polymatch, 2)
	}

	// display
	if (type == "new") {
		dom.mathdata.innerHTML = tzpdisplay.join("<br>") + newdisplay.join("<br>")
		dom.report.innerHTML = report.join("<br>")
	}
}

function get_code(type, hash) {
	let r = "", color = s3
	// template
	//else if (hash == "") {r=""}

	// MAIN TEST
	if (type == "new") {
		// FF
		if (hash == "55b23bcbc0a5f9e6479a219442a753de42945632")      {r="F1" } // Win7 64bit: FF68-82 64bit [CONTROL]
		else if (hash == "387ec24f7d465f6cc8586810ab573d33b4deb1bd") {r="F2" } // Win7 64bit: FF60-76 64bit
		else if (hash == "90b975639f11fffdff221f89ffc773b545198cf0") {r="F10"} // aarch64: Fenix80, TBA68 (and therefore FF68)
		else if (hash == "28e670c427690c9e06fee99660e42cd44face90d") {r="F20"} // Linux64 (homebrew): FF82 64bit
		// TB
		else if (hash == "2665ead0ed40201e071f3a55cafcb4d5de7c655b") {r="F96"} // Win7 64bit: TB68-78 64bit
		else if (hash == "b7971966da5399fec9ff39963080beae71fd1930") {r="F97"} // Win7 64bit: TB68-78 32bit
		else if (hash == "ab9409fb13ee526847ffa797a4696f139e5922cf") {r="F98"} // Win7 64bit: TB60 64bit
		else if (hash == "21e7548068a0aef1cfe56c6e58ca6f8524da581d") {r="F99"} // Win7 64bit: TB60 32bit
		// CHROME
		else if (hash == "0434f008dc65d44cd67a49656aa21f38e8e93a6e") { r="C1"}  // 72-85 32+64bit Win7 64bit
		// MAC
		else if (hash == "") { r=""}

	// TZP EXTENDED
	} else {
			color = s12
			// known FF hashes
			if (hash == "da51d38c6fcfc30599124515a36779c0d021a58d")      {r="A"}
			else if (hash == "ee9207e29c9d8ddb58d77a447a112854dec5ba50") {r="B"}
			else if (hash == "ace0a461947f4a157233e001b8d18d79113fa825") {r="F"} // aarch64 + pixel3: Fenix
			else if (hash == "99502fa552f399f8d9151e7fbfaf12ef905de3a3") {r="G"} // Linux64 (homebrew): FF82 64bit
			// new to TZP
			else if (hash == "25e085626b57813701d5f2f4c33029a1e4c56f27") {r="Z"} // TB60 32bit Win7 64bit
			// notation
	}
	// NEW
	if (r == "") {r = zNEW} else {r = color+"["+ r +"]"+sc}
	return r
}

function outputMath(control) {
	// clear everything
	let items = document.getElementsByClassName("c mono")
	for (let i=0; i < items.length; i++) {items[i].textContent = ""}	

	// controlnames
	if (control == "firefox") {
		controlname = "Firefox 78 64bit on Windows 64bit"
	} else if (control == "chrome") {
		controlname = "Chrome 85 64bit on Windows 64bit"
	} else if (control == "mac") {
		controlname = "Safari 13.0.5 on MacOS Catalina [VM 64bit on Windows 10 64bit]"
	}
	dom.controlname = controlname

	// build tzpfns and newfns
	build_arrays(control)
	// run
	get_results("tzp")
	get_results("new")

}

if ("undefined" != typeof InstallTrigger) {isFF = true}


</script>
</body>
</html>
